<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <title>Users</title>
</head>
<body>
<main class="content">
				<div class="container-fluid p-0">
					<div class="row">
						<div class="col-12">
							<div class="card">
								<div class="card-header">
								<i class="fa fa-broken fs-4 text-primary"></i> <span class="card-title fs-5">Users Account</span>
									<h6 class="card-subtitle text-muted fs-6">You can add new users, update and delete also. fill free to use our systemüòç.</h6>
									<hr style="border: 1px solid #000;">
									<button type="button" class="btn btn-primary my-1 float-end" data-bs-toggle="modal" data-bs-target="#addUserModal" id="addNew">
                                        Add New User
                                    </button>

								</div>
								<div class="card-body">
									<table id="categoryTable" class="table table-striped DataTableResponsive" style="width:100%">
										<thead class="table">
											<tr>
												<th>#</th>
												<th>Full Name</th>
												<th>Email</th>
												<th>Password</th>
												<th>Date Of Birth</th>
												<th>Gender</th>
												<th>Address</th>
												<th>User Roll</th>
												<th>Join Date</th>
												<th>Actions</th>
											</tr>
										</thead>
										<tbody style="font-size: 12px;">
											{% for user in users %}
												<tr>
													<td>{{ user['id'] }}</td>
													<td>{{ user['fullName'] }}</td>
													<td>{{ user['email'] }}</td>
													<td>{{ user['password'] }}</td>
													<td>{{ user['dob'] }}</td>
													<td>{{ user['gender'] }}</td>
													<td>{{ user['location'] }}</td>
													<td>{{ user['userRole'] }}</td>
													<td>{{ user['joinDate'] }}</td>
													<td>
														<a class="btn btn-info" onclick="showUpdateModal('{{ user.id }}', '{{ user.fullName }}', '{{ user.email }}', '{{ user.password }}', '{{ user.dob }}', '{{ user.gender }}', '{{ user.location }}', '{{ user.userRole }}')"><i class="fa fa-edit text-light"></i></a>
														<a class="btn btn-danger" onclick="deleteUser('{{ user.id }}')"><i class="fa fa-trash text-light"></i></a>
													</td>
												</tr>
											 {% endfor %}
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>

				</div>

								<!-- Add User Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1" role="dialog" aria-labelledby="addUserModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addUserModalLabel">Add New User</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" class="form-control" name="fullName" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" class="form-control" name="password" required>
                    </div>

                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" class="form-control" name="dob" required>
                    </div>

					<div class="form-group">
						<label>Gender</label>
                        <select class="form-control" name="gender">
							<option value="Male">Male</option>
							<option value="Female">Female</option>
						</select>
                    </div>

					<div class="form-group">
                        <label>Location</label>
                        <input type="text" class="form-control" name="location" required>
                    </div>

					<div class="form-group">
						<label>User Roll</label>
                        <select class="form-control" name="userRole">
							<option value="User">User</option>
							<option value="Admin">Admin</option>
						</select>
                    </div>
                    <!-- Additional fields as needed -->
                    <button type="submit" class="btn btn-primary">Add User</button>
                </form>
            </div>
        </div>
    </div>
</div>

	<!-- Update User Modal -->
<div class="modal fade" id="updateUserModal" tabindex="-1" role="dialog" aria-labelledby="updateUserModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateUserModalLabel">Update User</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="updateUserForm">
                    <input type="hidden" name="id" value="">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" class="form-control" name="fullName" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
					<div class="form-group">
                        <label>Password</label>
                        <input type="password" name="password" class="form-control" required>
                    </div>
					<div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" class="form-control" name="dob" required>
                    </div>

					<div class="form-group">
						<label>Gender</label>
                        <select class="form-control" name="gender">
							<option value="Male">Male</option>
							<option value="Female">Female</option>
						</select>
                    </div>

					<div class="form-group">
                        <label>Location</label>
                        <input type="text" class="form-control" name="location" required>
                    </div>

					<div class="form-group">
						<label>User Roll</label>
                        <select class="form-control" name="userRole">
							<option value="User">User</option>
							<option value="Admin">Admin</option>
						</select>
                    </div>
                    <!-- Additional fields as needed -->
                    <button type="submit" class="btn btn-primary">Update User</button>
                </form>
            </div>
        </div>
    </div>
</div>
</main>

<!-- Include Bootstrap CSS and JS -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

<!-- Include SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>


<script>
    $('#addNew').on('click', function() {
    $('#addUserModal').modal('show');
    });
function showUpdateModal(id, fullName, email, password, dob, gender, location, userRole) {
    $('#updateUserForm input[name="id"]').val(id);
    $('#updateUserForm input[name="fullName"]').val(fullName);
    $('#updateUserForm input[name="email"]').val(email);
    $('#updateUserForm input[name="password"]').val(password);
    $('#updateUserForm input[name="dob"]').val(dob);
    $('#updateUserForm input[name="gender"]').val(gender);
    $('#updateUserForm input[name="location"]').val(location);
    $('#updateUserForm input[name="userRole"]').val(userRole);
    $('#updateUserModal').modal('show');
}

$('#addUserForm').on('submit', function(e) {
    e.preventDefault();
    $.ajax({
        url: '/users/add',
        type: 'POST',
        data: $(this).serialize(),

        success: function(resp) {
            $('#addUserModal').modal('hide');
            Swal.fire('Success', 'User added successfully', 'success');
        },
        error: function() {
            Swal.fire('Error', 'Failed to add user', 'error');
        }
    });
});

$('#updateUserForm').on('submit', function(e) {
    e.preventDefault();
    $.ajax({
        url: '/users/update/' + $('input[name="id"]').val(),
        type: 'POST',
        data: $(this).serialize(),
        success: function(resp) {
            $('#updateUserModal').modal('hide');
            Swal.fire('Success', 'User updated successfully', 'success');
        },
        error: function() {
            Swal.fire('Error', 'Failed to update user', 'error');
        }
    });
});

function deleteUser(id) {
    Swal.fire({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                url: '/users/delete/' + id,
                type: 'GET',
                success: function(resp) {
                    Swal.fire('Deleted!', 'User has been deleted.', 'success').then((result) => {
                        if (result.isConfirmed) {
                            location.reload(); // Reload the page to see the changes
                        }
                    });
                },
                error: function() {
                    Swal.fire('Failed!', 'There was a problem deleting the user.', 'error');
                }
            });
        }
    });
}
</script>

</body>
</html>